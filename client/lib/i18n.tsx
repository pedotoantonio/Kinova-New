import React, { createContext, useContext, useState, useCallback, ReactNode } from "react";
import AsyncStorage from "@react-native-async-storage/async-storage";

export type Language = "it" | "en";

const translations = {
  it: {
    common: {
      loading: "Caricamento...",
      error: "Errore",
      retry: "Riprova",
      cancel: "Annulla",
      save: "Salva",
      delete: "Elimina",
      edit: "Modifica",
      create: "Crea",
      confirm: "Conferma",
      yes: "Sì",
      no: "No",
      today: "Oggi",
      tomorrow: "Domani",
      yesterday: "Ieri",
    },
    auth: {
      login: "Accedi",
      logout: "Esci",
      register: "Registrati",
      pleaseLogin: "Effettua l'accesso",
      welcomeBack: "Bentornato",
      createYourAccount: "Crea il tuo account",
      createAccount: "Crea Account",
      alreadyHaveAccount: "Hai già un account? Accedi",
      createNewAccount: "Crea nuovo account",
      enterCredentials: "Inserisci email e password",
      authFailed: "Autenticazione fallita",
      or: "oppure",
      email: "Email",
      password: "Password",
      confirmPassword: "Conferma password",
      displayNameOptional: "Nome visualizzato (opzionale)",
      confirmLogout: "Sei sicuro di voler uscire?",
      logoutAll: "Esci da tutti i dispositivi",
      logoutAllConfirm: "Verrai disconnesso da tutti i dispositivi. Continuare?",
      logoutAllSuccess: "Disconnesso da tutti i dispositivi",
      forgotPassword: "Password dimenticata?",
      resetPassword: "Reimposta password",
      resetPasswordSent: "Se esiste un account con questa email, riceverai un link per reimpostare la password",
      newPassword: "Nuova password",
      resetPasswordSuccess: "Password reimpostata con successo",
      verifyEmail: "Verifica email",
      verifyEmailSent: "Abbiamo inviato un'email di verifica a {email}",
      verifyEmailSuccess: "Email verificata con successo",
      resendVerification: "Invia nuova email",
      emailNotVerified: "Email non ancora verificata",
      acceptTerms: "Accetto i termini di servizio e l'informativa sulla privacy",
      termsRequired: "Devi accettare i termini per continuare",
      passwordStrength: {
        weak: "Debole",
        fair: "Discreta",
        good: "Buona",
        strong: "Forte",
      },
      passwordRequirements: {
        title: "La password deve contenere:",
        minLength: "Almeno 8 caratteri",
        uppercase: "Una lettera maiuscola",
        lowercase: "Una lettera minuscola",
        number: "Un numero",
        symbol: "Un simbolo (!@#$%...)",
      },
      errors: {
        invalidEmail: "Formato email non valido",
        emailExists: "Esiste già un account con questa email",
        weakPassword: "La password non soddisfa i requisiti",
        invalidCredentials: "Credenziali non valide",
        rateLimited: "Troppi tentativi. Riprova tra {minutes} minuti",
        tokenExpired: "Il link è scaduto",
        invalidToken: "Link non valido o scaduto",
      },
    },
    home: {
      title: "Home",
      welcomeTo: "Benvenuto in",
      yourFamily: "La tua Famiglia",
      familyMembers: "Membri della Famiglia",
      noFamilyMembers: "Nessun membro ancora",
      todayEvents: "Oggi",
      noEventsToday: "Nessun impegno oggi",
      viewCalendar: "Vedi calendario",
      member: "membro",
      members: "membri",
      shoppingList: "Lista Spesa",
      nothingToBuy: "Niente da comprare",
      viewShopping: "Vedi lista",
      pendingTasks: "Attività",
      noTasksPending: "Nessuna attività",
      viewTasks: "Vedi attività",
      overdue: "scaduta",
      overdueCount: "{count} scadute",
      monthlyBudget: "Budget mensile",
      viewBudget: "Vedi budget",
    },
    calendar: {
      title: "Calendario",
      addEvent: "Aggiungi evento",
      noEvents: "Nessun evento",
      noUpcomingEvents: "Nessun evento in programma",
      eventTitle: "Titolo evento",
      eventDescription: "Descrizione",
      shortCode: "Codice breve",
      shortCodeHint: "Es. MM, CF, AP",
      startDate: "Data inizio",
      endDate: "Data fine",
      allDay: "Tutto il giorno",
      selectColor: "Seleziona colore",
      category: "Categoria",
      assignTo: "Assegna a",
      deleteEvent: "Elimina evento",
      deleteConfirm: "Sei sicuro di voler eliminare questo evento?",
      eventCreated: "Evento creato",
      eventUpdated: "Evento aggiornato",
      eventDeleted: "Evento eliminato",
      titleRequired: "Il titolo è obbligatorio",
      moreEvents: "+{count} altri",
      viewAll: "Vedi tutti",
      sun: "Dom",
      mon: "Lun",
      tue: "Mar",
      wed: "Mer",
      thu: "Gio",
      fri: "Ven",
      sat: "Sab",
      weekend: "Fine settimana",
      months: [
        "Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno",
        "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre"
      ],
      categories: {
        family: "Famiglia",
        course: "Corso",
        shift: "Turno",
        vacation: "Ferie",
        holiday: "Festività",
        other: "Altro",
      },
      recurrence: {
        title: "Ricorrenza",
        none: "Nessuna",
        daily: "Giornaliera",
        weekly: "Settimanale",
        monthly: "Mensile",
        interval: "Ogni",
        days: "giorni",
        weeks: "settimane",
        months: "mesi",
        endDate: "Data fine ricorrenza",
        noEnd: "Senza fine",
      },
      filters: {
        title: "Filtri",
        all: "Tutti",
        byCategory: "Per categoria",
        byMember: "Per membro",
        reset: "Azzera filtri",
        active: "Filtri attivi",
      },
    },
    tasks: {
      title: "Attività",
      addTask: "Aggiungi attività",
      noTasks: "Nessuna attività",
      completed: "Completate",
      pending: "In sospeso",
      overdue: "Scadute",
      all: "Tutte",
      taskTitle: "Titolo attività",
      taskDescription: "Descrizione",
      dueDate: "Scadenza",
      assignTo: "Assegna a",
      priority: "Priorità",
      priorityLow: "Bassa",
      priorityMedium: "Media",
      priorityHigh: "Alta",
      deleteTask: "Elimina attività",
      deleteConfirm: "Sei sicuro di voler eliminare questa attività?",
      markComplete: "Segna come completata",
      markIncomplete: "Segna come da fare",
      noAssignment: "Non assegnata",
      titleRequired: "Il titolo è obbligatorio",
    },
    shopping: {
      title: "Lista spesa",
      addItem: "Aggiungi prodotto",
      noItems: "Niente da comprare",
      nothingToBuy: "Niente da comprare",
      purchased: "Acquistati",
      toBuy: "Da comprare",
      all: "Tutti",
      itemName: "Nome prodotto",
      quantity: "Quantità",
      unit: "Unità",
      category: "Categoria",
      deleteItem: "Elimina prodotto",
      deleteConfirm: "Sei sicuro di voler eliminare questo prodotto?",
      markPurchased: "Segna come acquistato",
      markToBuy: "Segna come da comprare",
      nameRequired: "Il nome è obbligatorio",
    },
    lists: {
      title: "Liste",
      shopping: "Spesa",
      tasks: "Attività",
    },
    budget: {
      title: "Budget",
      addExpense: "Aggiungi spesa",
      noExpenses: "Nessuna spesa registrata",
      amount: "Importo",
      amountPlaceholder: "0,00",
      description: "Descrizione",
      descriptionPlaceholder: "Es. Spesa al supermercato",
      category: "Categoria",
      date: "Data",
      paidBy: "Pagato da",
      monthly: "Mensile",
      thisMonth: "Questo mese",
      breakdown: "Ripartizione",
      recentExpenses: "Spese recenti",
      total: "Totale",
      deleteExpense: "Elimina spesa",
      deleteConfirm: "Sei sicuro di voler eliminare questa spesa?",
      amountRequired: "L'importo è obbligatorio",
      amountPositive: "L'importo deve essere maggiore di zero",
      descriptionRequired: "La descrizione è obbligatoria",
      categories: {
        home: "Casa",
        groceries: "Spesa alimentare",
        school: "Scuola",
        transport: "Trasporti",
        leisure: "Tempo libero",
        other: "Altro",
      },
      monthlySpent: "Speso questo mese",
      noData: "Nessun dato",
      viewAll: "Vedi tutto",
    },
    profile: {
      title: "Profilo",
      settings: "Impostazioni",
      language: "Lingua",
      theme: "Tema",
      about: "Informazioni",
      city: "Città",
      selectCity: "Seleziona città",
      searchCity: "Cerca città...",
      noResults: "Nessun risultato",
      cityUpdated: "Città aggiornata",
      userId: "ID Utente",
      familyId: "ID Famiglia",
      role: "Ruolo",
      member: "Membro",
      none: "Nessuno",
      familySection: "La Mia Famiglia",
      familyName: "Nome Famiglia",
      familyMembers: "Membri",
      inviteMember: "Invita Membro",
      inviteCode: "Codice Invito",
      inviteCreated: "Invito creato! Condividi questo codice:",
      copyCode: "Copia Codice",
      codeCopied: "Codice copiato!",
      inviteExpires: "Scade il",
      noMembers: "Nessun membro",
      editPermissions: "Modifica permessi",
      removeMember: "Rimuovi membro",
      confirmRemove: "Sei sicuro di voler rimuovere questo membro dalla famiglia?",
      memberRemoved: "Membro rimosso",
      selectRole: "Seleziona ruolo",
      editFamilyName: "Modifica nome famiglia",
      familyNameUpdated: "Nome famiglia aggiornato",
    },
    donation: {
      title: "Supporta Kinova",
      subtitle: "Aiutaci a migliorare l'app per te e la tua famiglia",
      selectAmount: "Seleziona importo",
      customAmount: "Importo personalizzato",
      donate: "Dona",
      processing: "Elaborazione...",
      thankYou: "Grazie!",
      thankYouMessage: "La tua donazione aiuta a mantenere Kinova gratuita per tutti.",
      error: "Si è verificato un errore",
      disabled: "Le donazioni non sono attualmente disponibili",
      minMax: "Importo tra {min} e {max} {currency}",
    },
    weather: {
      title: "Meteo",
      current: "Adesso",
      today: "Oggi",
      tomorrow: "Domani",
      feelsLike: "Percepita",
      humidity: "Umidità",
      wind: "Vento",
      precipChance: "Probabilità pioggia",
      noCity: "Nessuna città impostata",
      setCity: "Imposta città",
      updating: "Aggiornamento...",
      lastUpdate: "Ultimo aggiornamento",
      high: "Max",
      low: "Min",
    },
    family: {
      admin: "Admin",
      member: "Membro",
      child: "Bambino",
      you: "Tu",
      members: "Membri famiglia",
      manageMembers: "Gestisci",
      inviteMember: "Invita membro",
      createInvite: "Crea invito",
      inviteCreated: "Invito creato",
      inviteCode: "Codice invito",
      inviteExpires: "Scade il",
      copyCode: "Copia codice",
      codeCopied: "Codice copiato",
      shareQR: "Condividi QR code",
      scanQR: "Scansiona QR",
      scanQRSubtitle: "Inquadra il codice QR per unirti a una famiglia",
      manualEntry: "Inserisci codice manualmente",
      inviteCodePlaceholder: "Codice invito",
      join: "Unisciti",
      joining: "Unione in corso...",
      joinSuccess: "Unito con successo!",
      invalidCode: "Codice non valido",
      codeExpired: "Codice scaduto",
      codeUsed: "Codice già utilizzato",
      editMember: "Modifica membro",
      firstName: "Nome",
      lastName: "Cognome",
      displayName: "Nome visualizzato",
      birthDate: "Data di nascita",
      role: "Ruolo",
      permissions: "Permessi",
      canViewCalendar: "Calendario",
      canViewTasks: "Attività",
      canViewShopping: "Spesa",
      canViewBudget: "Budget",
      canViewPlaces: "Luoghi",
      canModifyItems: "Modifica elementi",
      removeMember: "Rimuovi membro",
      removeConfirm: "Sei sicuro di voler rimuovere questo membro?",
      memberRemoved: "Membro rimosso",
      memberUpdated: "Membro aggiornato",
      cameraPermissionRequired: "Permesso fotocamera richiesto",
      cameraPermissionText: "Per scansionare i codici QR, consenti l'accesso alla fotocamera",
      enableCamera: "Abilita fotocamera",
      openSettings: "Apri Impostazioni",
      scanAgain: "Scansiona di nuovo",
      webNotSupported: "Usa l'app Expo Go per scansionare i codici QR",
      scanQRToJoin: "Scansiona QR per unirti",
      noMembers: "Nessun membro",
      birthday: "Compleanno",
    },
    errors: {
      networkError: "Errore di rete",
      serverError: "Errore del server",
      notFound: "Non trovato",
      unauthorized: "Non autorizzato",
      forbidden: "Accesso negato",
      validationError: "Errore di validazione",
    },
    assistant: {
      title: "Assistente",
      newChat: "Nuova chat",
      placeholder: "Scrivi un messaggio...",
      send: "Invia",
      stop: "Stop",
      stopped: "Interrotto",
      thinking: "Sto pensando...",
      attachFile: "Allega file",
      attachPhoto: "Scatta foto",
      attachGallery: "Scegli dalla galleria",
      uploadingFile: "Caricamento file...",
      fileUploaded: "File caricato",
      confirm: "Conferma",
      cancel: "Annulla",
      actionConfirm: "Vuoi confermare questa azione?",
      actionSuccess: "Azione completata",
      actionError: "Errore durante l'azione",
      noConversations: "Nessuna conversazione",
      startChat: "Inizia a chattare con l'assistente",
      deleteChat: "Elimina conversazione",
      deleteConfirm: "Eliminare questa conversazione?",
      permissionRequired: "Permesso richiesto per accedere a questa funzione",
      copy: "Copia",
      retry: "Riprova",
      regenerate: "Rigenera",
      analyzing: "Analisi in corso...",
      copied: "Copiato",
      confirmAction: "Confermare questa azione?",
      confirmCreateEvent: "Creare questo evento?",
      confirmUpdateEvent: "Modificare questo evento?",
      confirmDeleteEvent: "Eliminare questo evento?",
      confirmCreateTask: "Creare questa attività?",
      confirmCompleteTask: "Completare questa attività?",
      confirmDeleteTask: "Eliminare questa attività?",
      confirmAddShopping: "Aggiungere alla lista della spesa?",
      confirmRemoveShopping: "Rimuovere dalla lista della spesa?",
      confirmAddExpense: "Registrare questa spesa?",
    },
    places: {
      title: "Luoghi",
      addPlace: "Aggiungi luogo",
      editPlace: "Modifica luogo",
      noPlaces: "Nessun luogo salvato",
      selectPlace: "Seleziona luogo",
      createNew: "Crea nuovo",
      searchOrCreate: "Cerca o crea nuovo luogo",
      name: "Nome",
      nameRequired: "Il nome è obbligatorio",
      address: "Indirizzo",
      addressOptional: "Indirizzo (opzionale)",
      description: "Descrizione",
      descriptionOptional: "Descrizione (opzionale)",
      coordinates: "Coordinate",
      latitude: "Latitudine",
      longitude: "Longitudine",
      invalidLatitude: "Latitudine non valida (-90 a 90)",
      invalidLongitude: "Longitudine non valida (-180 a 180)",
      category: "Categoria",
      categories: {
        home: "Casa",
        work: "Lavoro",
        school: "Scuola",
        leisure: "Svago",
        other: "Altro",
      },
      deletePlace: "Elimina luogo",
      deleteConfirm: "Sei sicuro di voler eliminare questo luogo?",
      openMaps: "Apri in Google Maps",
      getDirections: "Ottieni indicazioni",
      useCurrentLocation: "Usa posizione attuale",
      locationPermissionRequired: "È necessario il permesso per la posizione",
      viewOnMap: "Vedi sulla mappa",
      savedPlaces: "Luoghi salvati",
      recentPlaces: "Luoghi recenti",
      noLocation: "Nessuna posizione",
    },
    notifications: {
      title: "Notifiche",
      noNotifications: "Nessuna notifica",
      markAllRead: "Segna tutte come lette",
      clearAll: "Cancella tutte",
      justNow: "Adesso",
      minutesAgo: "{count} min fa",
      hoursAgo: "{count} ore fa",
      daysAgo: "{count} giorni fa",
      settings: "Impostazioni notifiche",
      enabled: "Notifiche attive",
      calendar: "Calendario",
      tasks: "Attività",
      shopping: "Spesa",
      budget: "Budget",
      ai: "Assistente AI",
      quietHours: "Orari silenziosi",
      quietHoursStart: "Inizio",
      quietHoursEnd: "Fine",
      eventReminderMinutes: "Promemoria evento (minuti prima)",
      event_reminder: "Promemoria evento",
      event_reminder_msg: "{title} tra {minutes} minuti",
      event_allday: "Evento di oggi",
      event_allday_msg: "Oggi: {title}",
      event_multiday: "Inizio evento",
      event_multiday_msg: "Inizia oggi: {title}",
      event_modified: "Evento modificato",
      event_modified_msg: "{title} è stato aggiornato",
      event_cancelled: "Evento annullato",
      event_cancelled_msg: "{title} è stato cancellato",
      task_assigned: "Nuova attività",
      task_assigned_msg: "Ti è stata assegnata: {title}",
      task_due: "Attività in scadenza",
      task_due_msg: "{title} scade oggi",
      task_overdue: "Attività scaduta",
      task_overdue_msg: "{title} è scaduta",
      task_completed: "Attività completata",
      task_completed_msg: "{title} è stata completata",
      shopping_item_added: "Nuovo articolo",
      shopping_item_added_msg: "{name} aggiunto alla lista",
      shopping_list_long: "Lista spesa lunga",
      shopping_list_long_msg: "La lista ha {count} articoli",
      budget_threshold: "Soglia budget superata",
      budget_threshold_msg: "Hai superato il {percent}% del budget mensile",
      ai_suggestion: "Suggerimento",
      ai_suggestion_msg: "{message}",
      ai_alert: "Avviso",
      ai_alert_msg: "{message}",
    },
  },
  en: {
    common: {
      loading: "Loading...",
      error: "Error",
      retry: "Retry",
      cancel: "Cancel",
      save: "Save",
      delete: "Delete",
      edit: "Edit",
      create: "Create",
      confirm: "Confirm",
      yes: "Yes",
      no: "No",
      today: "Today",
      tomorrow: "Tomorrow",
      yesterday: "Yesterday",
    },
    auth: {
      login: "Login",
      logout: "Logout",
      register: "Register",
      pleaseLogin: "Please log in",
      welcomeBack: "Welcome back",
      createYourAccount: "Create your account",
      createAccount: "Create Account",
      alreadyHaveAccount: "Already have an account? Login",
      createNewAccount: "Create new account",
      enterCredentials: "Please enter email and password",
      authFailed: "Authentication failed",
      or: "or",
      email: "Email",
      password: "Password",
      confirmPassword: "Confirm password",
      displayNameOptional: "Display Name (optional)",
      confirmLogout: "Are you sure you want to logout?",
      logoutAll: "Logout from all devices",
      logoutAllConfirm: "You will be logged out from all devices. Continue?",
      logoutAllSuccess: "Logged out from all devices",
      forgotPassword: "Forgot password?",
      resetPassword: "Reset password",
      resetPasswordSent: "If an account exists with this email, you will receive a password reset link",
      newPassword: "New password",
      resetPasswordSuccess: "Password reset successfully",
      verifyEmail: "Verify email",
      verifyEmailSent: "We sent a verification email to {email}",
      verifyEmailSuccess: "Email verified successfully",
      resendVerification: "Resend email",
      emailNotVerified: "Email not yet verified",
      acceptTerms: "I accept the terms of service and privacy policy",
      termsRequired: "You must accept the terms to continue",
      passwordStrength: {
        weak: "Weak",
        fair: "Fair",
        good: "Good",
        strong: "Strong",
      },
      passwordRequirements: {
        title: "Password must contain:",
        minLength: "At least 8 characters",
        uppercase: "One uppercase letter",
        lowercase: "One lowercase letter",
        number: "One number",
        symbol: "One symbol (!@#$%...)",
      },
      errors: {
        invalidEmail: "Invalid email format",
        emailExists: "An account with this email already exists",
        weakPassword: "Password does not meet requirements",
        invalidCredentials: "Invalid credentials",
        rateLimited: "Too many attempts. Try again in {minutes} minutes",
        tokenExpired: "The link has expired",
        invalidToken: "Invalid or expired link",
      },
    },
    home: {
      title: "Home",
      welcomeTo: "Welcome to",
      yourFamily: "Your Family",
      familyMembers: "Family Members",
      noFamilyMembers: "No family members yet",
      todayEvents: "Today",
      noEventsToday: "No events today",
      viewCalendar: "View calendar",
      member: "member",
      members: "members",
      shoppingList: "Shopping List",
      nothingToBuy: "Nothing to buy",
      viewShopping: "View list",
      pendingTasks: "Tasks",
      noTasksPending: "No pending tasks",
      viewTasks: "View tasks",
      overdue: "overdue",
      overdueCount: "{count} overdue",
      monthlyBudget: "Monthly budget",
      viewBudget: "View budget",
    },
    calendar: {
      title: "Calendar",
      addEvent: "Add event",
      noEvents: "No events",
      noUpcomingEvents: "No upcoming events",
      eventTitle: "Event title",
      eventDescription: "Description",
      shortCode: "Short code",
      shortCodeHint: "E.g. MM, CF, AP",
      startDate: "Start date",
      endDate: "End date",
      allDay: "All day",
      selectColor: "Select color",
      category: "Category",
      assignTo: "Assign to",
      deleteEvent: "Delete event",
      deleteConfirm: "Are you sure you want to delete this event?",
      eventCreated: "Event created",
      eventUpdated: "Event updated",
      eventDeleted: "Event deleted",
      titleRequired: "Title is required",
      moreEvents: "+{count} more",
      viewAll: "View all",
      sun: "Sun",
      mon: "Mon",
      tue: "Tue",
      wed: "Wed",
      thu: "Thu",
      fri: "Fri",
      sat: "Sat",
      weekend: "Weekend",
      months: [
        "January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
      ],
      categories: {
        family: "Family",
        course: "Course",
        shift: "Shift",
        vacation: "Vacation",
        holiday: "Holiday",
        other: "Other",
      },
      recurrence: {
        title: "Recurrence",
        none: "None",
        daily: "Daily",
        weekly: "Weekly",
        monthly: "Monthly",
        interval: "Every",
        days: "days",
        weeks: "weeks",
        months: "months",
        endDate: "Recurrence end date",
        noEnd: "No end",
      },
      filters: {
        title: "Filters",
        all: "All",
        byCategory: "By category",
        byMember: "By member",
        reset: "Reset filters",
        active: "Active filters",
      },
    },
    tasks: {
      title: "Tasks",
      addTask: "Add task",
      noTasks: "No tasks",
      completed: "Completed",
      pending: "Pending",
      overdue: "Overdue",
      all: "All",
      taskTitle: "Task title",
      taskDescription: "Description",
      dueDate: "Due date",
      assignTo: "Assign to",
      priority: "Priority",
      priorityLow: "Low",
      priorityMedium: "Medium",
      priorityHigh: "High",
      deleteTask: "Delete task",
      deleteConfirm: "Are you sure you want to delete this task?",
      markComplete: "Mark as complete",
      markIncomplete: "Mark as incomplete",
      noAssignment: "Unassigned",
      titleRequired: "Title is required",
    },
    shopping: {
      title: "Shopping list",
      addItem: "Add item",
      noItems: "Nothing to buy",
      nothingToBuy: "Nothing to buy",
      purchased: "Purchased",
      toBuy: "To buy",
      all: "All",
      itemName: "Item name",
      quantity: "Quantity",
      unit: "Unit",
      category: "Category",
      deleteItem: "Delete item",
      deleteConfirm: "Are you sure you want to delete this item?",
      markPurchased: "Mark as purchased",
      markToBuy: "Mark as to buy",
      nameRequired: "Name is required",
    },
    lists: {
      title: "Lists",
      shopping: "Shopping",
      tasks: "Tasks",
    },
    budget: {
      title: "Budget",
      addExpense: "Add expense",
      noExpenses: "No expenses recorded",
      amount: "Amount",
      amountPlaceholder: "0.00",
      description: "Description",
      descriptionPlaceholder: "E.g. Grocery shopping",
      category: "Category",
      date: "Date",
      paidBy: "Paid by",
      monthly: "Monthly",
      thisMonth: "This month",
      breakdown: "Breakdown",
      recentExpenses: "Recent expenses",
      total: "Total",
      deleteExpense: "Delete expense",
      deleteConfirm: "Are you sure you want to delete this expense?",
      amountRequired: "Amount is required",
      amountPositive: "Amount must be greater than zero",
      descriptionRequired: "Description is required",
      categories: {
        home: "Home",
        groceries: "Groceries",
        school: "School",
        transport: "Transport",
        leisure: "Leisure",
        other: "Other",
      },
      monthlySpent: "Spent this month",
      noData: "No data",
      viewAll: "View all",
    },
    profile: {
      title: "Profile",
      settings: "Settings",
      language: "Language",
      theme: "Theme",
      about: "About",
      city: "City",
      selectCity: "Select city",
      searchCity: "Search city...",
      noResults: "No results",
      cityUpdated: "City updated",
      userId: "User ID",
      familyId: "Family ID",
      role: "Role",
      member: "Member",
      none: "None",
      familySection: "My Family",
      familyName: "Family Name",
      familyMembers: "Members",
      inviteMember: "Invite Member",
      inviteCode: "Invite Code",
      inviteCreated: "Invite created! Share this code:",
      copyCode: "Copy Code",
      codeCopied: "Code copied!",
      inviteExpires: "Expires on",
      noMembers: "No members",
      editPermissions: "Edit permissions",
      removeMember: "Remove member",
      confirmRemove: "Are you sure you want to remove this member from the family?",
      memberRemoved: "Member removed",
      selectRole: "Select role",
      editFamilyName: "Edit family name",
      familyNameUpdated: "Family name updated",
    },
    donation: {
      title: "Support Kinova",
      subtitle: "Help us improve the app for you and your family",
      selectAmount: "Select amount",
      customAmount: "Custom amount",
      donate: "Donate",
      processing: "Processing...",
      thankYou: "Thank you!",
      thankYouMessage: "Your donation helps keep Kinova free for everyone.",
      error: "An error occurred",
      disabled: "Donations are currently unavailable",
      minMax: "Amount between {min} and {max} {currency}",
    },
    weather: {
      title: "Weather",
      current: "Now",
      today: "Today",
      tomorrow: "Tomorrow",
      feelsLike: "Feels like",
      humidity: "Humidity",
      wind: "Wind",
      precipChance: "Precipitation chance",
      noCity: "No city set",
      setCity: "Set city",
      updating: "Updating...",
      lastUpdate: "Last update",
      high: "High",
      low: "Low",
    },
    family: {
      admin: "Admin",
      member: "Member",
      child: "Child",
      you: "You",
      members: "Family members",
      manageMembers: "Manage",
      inviteMember: "Invite member",
      createInvite: "Create invite",
      inviteCreated: "Invite created",
      inviteCode: "Invite code",
      inviteExpires: "Expires on",
      copyCode: "Copy code",
      codeCopied: "Code copied",
      shareQR: "Share QR code",
      scanQR: "Scan QR",
      scanQRSubtitle: "Point camera at QR code to join a family",
      manualEntry: "Enter code manually",
      inviteCodePlaceholder: "Invite code",
      join: "Join",
      joining: "Joining...",
      joinSuccess: "Joined successfully!",
      invalidCode: "Invalid code",
      codeExpired: "Code expired",
      codeUsed: "Code already used",
      editMember: "Edit member",
      firstName: "First name",
      lastName: "Last name",
      displayName: "Display name",
      birthDate: "Birth date",
      role: "Role",
      permissions: "Permissions",
      canViewCalendar: "Calendar",
      canViewTasks: "Tasks",
      canViewShopping: "Shopping",
      canViewBudget: "Budget",
      canViewPlaces: "Places",
      canModifyItems: "Edit items",
      removeMember: "Remove member",
      removeConfirm: "Are you sure you want to remove this member?",
      memberRemoved: "Member removed",
      memberUpdated: "Member updated",
      cameraPermissionRequired: "Camera permission required",
      cameraPermissionText: "To scan QR codes, allow camera access",
      enableCamera: "Enable Camera",
      openSettings: "Open Settings",
      scanAgain: "Scan Again",
      webNotSupported: "Use Expo Go app to scan QR codes",
      scanQRToJoin: "Scan QR to join",
      noMembers: "No members",
      birthday: "Birthday",
    },
    errors: {
      networkError: "Network error",
      serverError: "Server error",
      notFound: "Not found",
      unauthorized: "Unauthorized",
      forbidden: "Access denied",
      validationError: "Validation error",
    },
    assistant: {
      title: "Assistant",
      newChat: "New chat",
      placeholder: "Type a message...",
      send: "Send",
      stop: "Stop",
      stopped: "Stopped",
      thinking: "Thinking...",
      attachFile: "Attach file",
      attachPhoto: "Take photo",
      attachGallery: "Choose from gallery",
      uploadingFile: "Uploading file...",
      fileUploaded: "File uploaded",
      confirm: "Confirm",
      cancel: "Cancel",
      actionConfirm: "Do you want to confirm this action?",
      actionSuccess: "Action completed",
      actionError: "Action failed",
      noConversations: "No conversations",
      startChat: "Start chatting with the assistant",
      deleteChat: "Delete conversation",
      deleteConfirm: "Delete this conversation?",
      permissionRequired: "Permission required to access this feature",
      copy: "Copy",
      retry: "Retry",
      regenerate: "Regenerate",
      analyzing: "Analyzing...",
      copied: "Copied",
      confirmAction: "Confirm this action?",
      confirmCreateEvent: "Create this event?",
      confirmUpdateEvent: "Update this event?",
      confirmDeleteEvent: "Delete this event?",
      confirmCreateTask: "Create this task?",
      confirmCompleteTask: "Complete this task?",
      confirmDeleteTask: "Delete this task?",
      confirmAddShopping: "Add to shopping list?",
      confirmRemoveShopping: "Remove from shopping list?",
      confirmAddExpense: "Record this expense?",
    },
    places: {
      title: "Places",
      addPlace: "Add place",
      editPlace: "Edit place",
      noPlaces: "No saved places",
      selectPlace: "Select place",
      createNew: "Create new",
      searchOrCreate: "Search or create new place",
      name: "Name",
      nameRequired: "Name is required",
      address: "Address",
      addressOptional: "Address (optional)",
      description: "Description",
      descriptionOptional: "Description (optional)",
      coordinates: "Coordinates",
      latitude: "Latitude",
      longitude: "Longitude",
      invalidLatitude: "Invalid latitude (-90 to 90)",
      invalidLongitude: "Invalid longitude (-180 to 180)",
      category: "Category",
      categories: {
        home: "Home",
        work: "Work",
        school: "School",
        leisure: "Leisure",
        other: "Other",
      },
      deletePlace: "Delete place",
      deleteConfirm: "Are you sure you want to delete this place?",
      openMaps: "Open in Google Maps",
      getDirections: "Get directions",
      useCurrentLocation: "Use current location",
      locationPermissionRequired: "Location permission is required",
      viewOnMap: "View on map",
      savedPlaces: "Saved places",
      recentPlaces: "Recent places",
      noLocation: "No location",
    },
    notifications: {
      title: "Notifications",
      noNotifications: "No notifications",
      markAllRead: "Mark all as read",
      clearAll: "Clear all",
      justNow: "Just now",
      minutesAgo: "{count} min ago",
      hoursAgo: "{count} hours ago",
      daysAgo: "{count} days ago",
      settings: "Notification settings",
      enabled: "Notifications enabled",
      calendar: "Calendar",
      tasks: "Tasks",
      shopping: "Shopping",
      budget: "Budget",
      ai: "AI Assistant",
      quietHours: "Quiet hours",
      quietHoursStart: "Start",
      quietHoursEnd: "End",
      eventReminderMinutes: "Event reminder (minutes before)",
      event_reminder: "Event reminder",
      event_reminder_msg: "{title} in {minutes} minutes",
      event_allday: "Today's event",
      event_allday_msg: "Today: {title}",
      event_multiday: "Event starts",
      event_multiday_msg: "Starts today: {title}",
      event_modified: "Event modified",
      event_modified_msg: "{title} has been updated",
      event_cancelled: "Event cancelled",
      event_cancelled_msg: "{title} has been cancelled",
      task_assigned: "New task",
      task_assigned_msg: "You were assigned: {title}",
      task_due: "Task due soon",
      task_due_msg: "{title} is due today",
      task_overdue: "Task overdue",
      task_overdue_msg: "{title} is overdue",
      task_completed: "Task completed",
      task_completed_msg: "{title} has been completed",
      shopping_item_added: "New item",
      shopping_item_added_msg: "{name} added to list",
      shopping_list_long: "Long shopping list",
      shopping_list_long_msg: "List has {count} items",
      budget_threshold: "Budget threshold exceeded",
      budget_threshold_msg: "You exceeded {percent}% of monthly budget",
      ai_suggestion: "Suggestion",
      ai_suggestion_msg: "{message}",
      ai_alert: "Alert",
      ai_alert_msg: "{message}",
    },
  },
} as const;

type DeepStringify<T> = T extends readonly string[]
  ? readonly string[]
  : T extends object
  ? { [K in keyof T]: DeepStringify<T[K]> }
  : T extends string
  ? string
  : T;

type TranslationKeys = DeepStringify<typeof translations["it"]>;

interface I18nContextType {
  language: Language;
  setLanguage: (lang: Language) => Promise<void>;
  t: TranslationKeys;
}

const I18nContext = createContext<I18nContextType | null>(null);

const STORAGE_KEY = "@kinova/language";

export function I18nProvider({ children }: { children: ReactNode }) {
  const [language, setLanguageState] = useState<Language>("it");
  const [isLoaded, setIsLoaded] = useState(false);

  React.useEffect(() => {
    AsyncStorage.getItem(STORAGE_KEY).then((stored) => {
      if (stored === "en" || stored === "it") {
        setLanguageState(stored);
      }
      setIsLoaded(true);
    });
  }, []);

  const setLanguage = useCallback(async (lang: Language) => {
    setLanguageState(lang);
    await AsyncStorage.setItem(STORAGE_KEY, lang);
  }, []);

  const value: I18nContextType = {
    language,
    setLanguage,
    t: translations[language] as TranslationKeys,
  };

  if (!isLoaded) {
    return null;
  }

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n(): I18nContextType {
  const context = useContext(I18nContext);
  if (!context) {
    throw new Error("useI18n must be used within an I18nProvider");
  }
  return context;
}

export function useTranslation() {
  const { t, language } = useI18n();
  return { t, language };
}
